# satellite image time series package (SITS)
# example of clustering using self-organizin maps
library(sits)
library(kohonen)

# Retrieve the set of samples for the Mato Grosso region (provided by EMBRAPA)
#select the bands for classification
if (!requireNamespace("inSitu", quietly = TRUE)) {
    if (!requireNamespace("devtools", quietly = TRUE))
        install.packages("devtools")
    devtools::install_github("e-sensing/inSitu")
}
library(inSitu)

#select the bands for classification
samples <- inSitu::br_mt_2K_9classes_6bands


#Clustering time series samples using self-organizing maps
som_cluster.tb <-
    sits_cluster_som(
        samples,
        grid_xdim = 20,
        grid_ydim = 20,
        rlen = 100,
        alpha = 1,
        distance = "euclidean",
        mode =  "pbatch",
        iterations = 2
    )

sits_plot_som(som_cluster.tb)

#Remove samples that have  bad quality
new_samples.tb <- sits_clean_samples_som(som_cluster.tb)

#Evaluate the quality of the clusters generated by SOM
cluster_overall <- sits_evaluate_cluster(som_cluster.tb)
confusion_matrix <- cluster_overall$confusion_matrix
sits_plot_cluster_info(cluster_overall, "Confusion by cluster")

#Divide samples in subgroups
subgroups <- sits_evaluate_som_subgroups(som_cluster.tb)
sits_plot_subgroups(subgroups, cluster = "Soy_Corn", band = "ndvi")


